<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shamadi Plaza - Ventas</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        :root { --p-color: #8B4513; --s-color: #D2B48C; }
        body { background-color: #f9f9f9; }
        .navbar { background-color: var(--p-color); color: white; }
        .category-title { color: var(--p-color); border-bottom: 2px solid var(--s-color); margin-top: 2rem; }
        .card-img-top { height: 200px; object-fit: cover; }
        .modal-header { background-color: var(--p-color); color: white; }
        .btn-primary { background-color: var(--p-color); border: none; }
        .carousel-item { padding: 15px; }
        #about-btn { cursor: pointer; color: white; text-decoration: underline; }
    </style>
</head>
<body>

<nav class="navbar px-4 d-flex justify-content-between">
    <div class="d-flex align-items-center">
        <img src="logo.jpg" alt="Logo" height="50" class="me-2">
        <span class="fw-bold">Shamadi Plaza</span>
    </div>
    <a id="about-btn" onclick="showAbout()">Acerca de esta web</a>
</nav>

<div class="container my-4" id="main-container">
    </div>

<div class="modal fade" id="cartModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header"><h5>Confirmar Pedido</h5></div>
            <div class="modal-body" id="cart-details"></div>
            <div class="modal-footer">
                <button class="btn btn-success" onclick="sendWhatsApp()">Enviar a WhatsApp</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="aboutModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content text-center p-4">
            <h4>Datos del Desarrollador</h4>
            <p><strong>Antonio Itriago</strong><br>Analista, Diseñador y Desarrollador de Sistemas de Información Computarizados</p>
            <a href="https://wa.me/584122525407" class="btn btn-outline-success">Contactar: wa.me/584122525407</a>
        </div>
    </div>
</div>

<script src="config.js"></script>
<script>
    let cart = [];
    let bcvRate = 0;

    async function init() {
        bcvRate = await getBCVRate();
        const products = await fetchProducts();
        renderCategories(products);
    }

    function renderCategories(products) {
        const container = document.getElementById('main-container');
        const categories = [...new Set(products.map(p => p.category))];
        
        categories.forEach(cat => {
            const catProds = products.filter(p => p.category === cat);
            let html = `<h3 class="category-title">${cat}</h3><div class="row overflow-auto flex-nowrap pb-3">`;
            catProds.forEach(p => {
                html += `
                <div class="col-10 col-md-4">
                    <div class="card h-100">
                        <div class="card-body">
                            <h6>${p.name}</h6>
                            <p class="small text-muted">${p.description}</p>
                            <p class="fw-bold">$${p.price}</p>
                            <button class="btn btn-sm btn-primary" onclick="addToCart('${p.id}', '${p.name}', ${p.price})">Agregar</button>
                        </div>
                    </div>
                </div>`;
            });
            html += `</div>`;
            container.innerHTML += html;
        });
    }

    function addToCart(id, name, price) {
        cart.push({id, name, price});
        alert(`${name} agregado al pedido`);
    }

    async function showCart() {
        const distance = prompt("Introduce la distancia aproximada en km para el delivery:");
        const deliveryCost = distance * CONFIG.deliveryFactor;
        const totalUSD = cart.reduce((sum, item) => sum + item.price, 0) + deliveryCost;
        const totalVES = (totalUSD * bcvRate).toFixed(2);

        let details = `<ul>` + cart.map(i => `<li>${i.name} - $${i.price}</li>`).join('') + `</ul>`;
        details += `<p><strong>Tasa BCV:</strong> ${bcvRate} Bs/$</p>`;
        details += `<p><strong>Delivery aproximado es:</strong> $${deliveryCost.toFixed(2)}</p>`;
        details += `<h5>Total: $${totalUSD.toFixed(2)} / ${totalVES} Bs.</h5>`;
        
        document.getElementById('cart-details').innerHTML = details;
        new bootstrap.Modal(document.getElementById('cartModal')).show();
    }

    function showAbout() {
        new bootstrap.Modal(document.getElementById('aboutModal')).show();
    }

    function sendWhatsApp() {
        let message = `Hola, quiero realizar un pedido:\n` + cart.map(i => `- ${i.name}`).join('\n');
        message += `\nTotal: $${(cart.reduce((s,i)=>s+i.price,0)).toFixed(2)}`;
        window.open(`https://wa.me/${CONFIG.whatsappNumber}?text=${encodeURIComponent(message)}`);
    }

    init();
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
